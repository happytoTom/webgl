<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webgl通过缓冲区域绘制多个点</title>
    <script src="./util/shader.js"></script>
  </head>

  <body>
    <canvas
      id="web01"
      width="35"
      height="60"
      style="background-color: blue;"
    ></canvas>
    <script>
      let canvas = document.getElementById("web01");
      let gl = canvas.getContext("webgl");
      let VERTEX_SHADER = `
        attribute vec4 a_pos;\n
        uniform mat4 u_formMatrix;\n
        void main(){\n
        gl_Position=u_formMatrix * a_pos;\n
        gl_PointSize=1.0;\n
    }`;
      // 片段（片元）着色器
      let FRAG_SHADER = `
         precision lowp float;\n
         uniform vec4 u_color;\n
         void main(){\n
         gl_FragColor=u_color;\n
         }`;
      let program = initShader(gl, VERTEX_SHADER, FRAG_SHADER);

      let outLineList = [
        -0.16666666666666666,
        1,
        -0.20833333333333334,
        0.9759036144578314,
        -0.25,
        0.9759036144578314,
        -0.2916666666666667,
        0.9518072289156626,
        -0.3333333333333333,
        0.927710843373494,
        -0.375,
        0.9036144578313253,
        -0.375,
        0.8795180722891566,
        -0.4166666666666667,
        0.8554216867469879,
        -0.4166666666666667,
        0.8313253012048193,
        -0.4166666666666667,
        0.8072289156626506,
        -0.4166666666666667,
        0.7831325301204819,
        -0.4166666666666667,
        0.7590361445783133,
        -0.4166666666666667,
        0.7349397590361446,
        -0.4166666666666667,
        0.7108433734939759,
        -0.4166666666666667,
        0.6867469879518072,
        -0.4166666666666667,
        0.6626506024096386,
        -0.4583333333333333,
        0.6385542168674698,
        -0.4583333333333333,
        0.6144578313253012,
        -0.5,
        0.5903614457831325,
        -0.5416666666666666,
        0.5662650602409639,
        -0.5833333333333334,
        0.5421686746987951,
        -0.625,
        0.5180722891566265,
        -0.6666666666666666,
        0.4939759036144578,
        -0.6666666666666666,
        0.46987951807228917,
        -0.6666666666666666,
        0.4457831325301205,
        -0.7083333333333334,
        0.42168674698795183,
        -0.7083333333333334,
        0.39759036144578314,
        -0.7083333333333334,
        0.37349397590361444,
        -0.7083333333333334,
        0.3493975903614458,
        -0.7083333333333334,
        0.3253012048192771,
        -0.7083333333333334,
        0.30120481927710846,
        -0.7083333333333334,
        0.27710843373493976,
        -0.75,
        0.25301204819277107,
        -0.75,
        0.2289156626506024,
        -0.7916666666666666,
        0.20481927710843373,
        -0.7916666666666666,
        0.18072289156626506,
        -0.8333333333333334,
        0.1566265060240964,
        -0.8333333333333334,
        0.13253012048192772,
        -0.875,
        0.10843373493975904,
        -0.9166666666666666,
        0.08433734939759036,
        -0.9166666666666666,
        0.060240963855421686,
        -0.9583333333333334,
        0.03614457831325301,
        -1,
        0.012048192771084338,
        -1,
        -0.012048192771084338,
        -1,
        -0.03614457831325301,
        -1,
        -0.060240963855421686,
        -1,
        -0.08433734939759036,
        -1,
        -0.10843373493975904,
        -1,
        -0.13253012048192772,
        -1,
        -0.1566265060240964,
        -0.9583333333333334,
        -0.18072289156626506,
        -0.9583333333333334,
        -0.20481927710843373,
        -0.9166666666666666,
        -0.2289156626506024,
        -0.9166666666666666,
        -0.25301204819277107,
        -0.875,
        -0.27710843373493976,
        -0.875,
        -0.30120481927710846,
        -0.8333333333333334,
        -0.3253012048192771,
        -0.8333333333333334,
        -0.3493975903614458,
        -0.7916666666666666,
        -0.37349397590361444,
        -0.75,
        -0.39759036144578314,
        -0.7083333333333334,
        -0.39759036144578314,
        -0.6666666666666666,
        -0.39759036144578314,
        -0.625,
        -0.42168674698795183,
        -0.5833333333333334,
        -0.39759036144578314,
        -0.5416666666666666,
        -0.39759036144578314,
        -0.5,
        -0.39759036144578314,
        -0.4583333333333333,
        -0.39759036144578314,
        -0.4166666666666667,
        -0.39759036144578314,
        -0.375,
        -0.39759036144578314,
        -0.3333333333333333,
        -0.39759036144578314,
        -0.2916666666666667,
        -0.39759036144578314,
        -0.25,
        -0.39759036144578314,
        -0.20833333333333334,
        -0.39759036144578314,
        -0.16666666666666666,
        -0.37349397590361444,
        -0.125,
        -0.37349397590361444,
        -0.08333333333333333,
        -0.3493975903614458,
        -0.041666666666666664,
        -0.3253012048192771,
        -0.041666666666666664,
        -0.30120481927710846,
        -0.041666666666666664,
        -0.27710843373493976,
        0,
        -0.25301204819277107,
        0,
        -0.2289156626506024,
        0,
        -0.20481927710843373,
        -0.041666666666666664,
        -0.18072289156626506,
        -0.041666666666666664,
        -0.1566265060240964,
        -0.041666666666666664,
        -0.13253012048192772,
        -0.08333333333333333,
        -0.10843373493975904,
        -0.08333333333333333,
        -0.08433734939759036,
        -0.08333333333333333,
        -0.060240963855421686,
        -0.125,
        -0.03614457831325301,
        -0.125,
        -0.012048192771084338,
        -0.125,
        0.012048192771084338,
        -0.08333333333333333,
        0.03614457831325301,
        -0.08333333333333333,
        0.060240963855421686,
        -0.041666666666666664,
        0.08433734939759036,
        -0.041666666666666664,
        0.10843373493975904,
        0,
        0.13253012048192772,
        0.041666666666666664,
        0.1566265060240964,
        0.041666666666666664,
        0.18072289156626506,
        0.08333333333333333,
        0.20481927710843373,
        0.125,
        0.2289156626506024,
        0.16666666666666666,
        0.25301204819277107,
        0.20833333333333334,
        0.27710843373493976,
        0.25,
        0.30120481927710846,
        0.25,
        0.3253012048192771,
        0.2916666666666667,
        0.3493975903614458,
        0.2916666666666667,
        0.37349397590361444,
        0.2916666666666667,
        0.39759036144578314,
        0.2916666666666667,
        0.42168674698795183,
        0.2916666666666667,
        0.4457831325301205,
        0.2916666666666667,
        0.46987951807228917,
        0.2916666666666667,
        0.4939759036144578,
        0.2916666666666667,
        0.5180722891566265,
        0.3333333333333333,
        0.5421686746987951,
        0.3333333333333333,
        0.5662650602409639,
        0.3333333333333333,
        0.5903614457831325,
        0.375,
        0.6144578313253012,
        0.375,
        0.6385542168674698,
        0.4166666666666667,
        0.6626506024096386,
        0.4166666666666667,
        0.6867469879518072,
        0.4166666666666667,
        0.7108433734939759,
        0.4166666666666667,
        0.7349397590361446,
        0.4166666666666667,
        0.7590361445783133,
        0.4166666666666667,
        0.7831325301204819,
        0.375,
        0.8072289156626506,
        0.375,
        0.8313253012048193,
        0.4166666666666667,
        0.8554216867469879,
        0.4166666666666667,
        0.8795180722891566,
        0.375,
        0.8795180722891566,
        0.3333333333333333,
        0.9036144578313253,
        0.2916666666666667,
        0.927710843373494,
        0.25,
        0.927710843373494,
        0.20833333333333334,
        0.9518072289156626,
        0.16666666666666666,
        0.9518072289156626,
        0.125,
        0.9759036144578314,
        0.08333333333333333,
        0.9759036144578314,
        0.041666666666666664,
        0.9759036144578314,
        0,
        1,
        -0.041666666666666664,
        1,
        -0.08333333333333333,
        1,
        -0.125,
        1,
      ];
      let zoom = 1.0;

      let map = outLineList.map((item) => {
        return item * zoom;
      });

      let dataVertices = new Float32Array(map);

      let buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      gl.bufferData(gl.ARRAY_BUFFER, dataVertices, gl.STATIC_DRAW);

      var Sx = 1.0,
        Sy = 1.0,
        Sz = 1.0;
      let formMatrix = new Float32Array([
        Sx,
        0.0,
        0.0,
        0.0,
        0.0,
        Sy,
        0.0,
        0.0,
        0.0,
        0.0,
        Sz,
        0.0,
        0.0,
        0.0,
        0.0,
        1.0,
      ]);

      let u_formMatrix = gl.getUniformLocation(program, "u_formMatrix");
      gl.uniformMatrix4fv(u_formMatrix, false, formMatrix);

      let a_position = gl.getAttachedShaders(program, "a_pos");
      gl.vertexAttribPointer(a_position, 2, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(a_position);

      let u_color = gl.getUniformLocation(program, "u_color");
      gl.vertexAttrib4f(a_position, 0.0, 0.0, 1.0, 1.0);
      gl.uniform4f(u_color, 0.0, 1.0, 0.0, 1.0);
      gl.viewport(0, 0, canvas.width, canvas.height);
      gl.drawArrays(gl.POINTS, 0, outLineList.length / 2);

      //   canvas.onmousedown = function (ev) {
      //     click(ev, gl, canvas);
      //   };

      //   function click(ev, gl, canvas, a_Position) {
      //     var x = ev.clientX;
      //     var y = ev.clientY;
      //     var rect = ev.target.getBoundingClientRect();
      //     // 计算点击位置在webgl系统中的x坐标
      //     var x = (x - rect.left - canvas.width / 2) / (canvas.width / 2);
      //     // 计算点击位置在webgl系统中的y坐标
      //     var y = (canvas.height / 2 - (y - rect.top)) / (canvas.height / 2);
      //     console.log(x, y);
      //   }
    </script>
  </body>
</html>
